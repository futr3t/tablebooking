const fs = require('fs');
const path = require('path');

// Read the new widget content
const widgetPath = path.join(__dirname, 'widget/dist/widget.js');
const widgetContent = fs.readFileSync(widgetPath, 'utf8');

// Escape the content for JavaScript string
const escapedContent = widgetContent
  .replace(/\\/g, '\\\\')
  .replace(/`/g, '\\`')
  .replace(/\${/g, '\\${');

// Create the new widget-content.ts file
const newContent = `// This file contains the compiled widget content for distribution
// Generated by webpack from the React widget source

export const WIDGET_JS_CONTENT = \`${escapedContent}\`;

// Export metadata about the widget
export const WIDGET_METADATA = {
  version: '1.0.0',
  description: 'Embeddable React booking widget for restaurant websites',
  size: WIDGET_JS_CONTENT.length,
  lastUpdated: new Date().toISOString()
};`;

// Write the updated file
const outputPath = path.join(__dirname, 'backend/src/widget-content.ts');
fs.writeFileSync(outputPath, newContent);

console.log('‚úÖ Widget content updated successfully');
console.log(`üìè Size: ${widgetContent.length} bytes`);
console.log(`üìÖ Updated: ${new Date().toISOString()}`);